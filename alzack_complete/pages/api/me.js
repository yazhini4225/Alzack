import { verifyToken } from '../../lib/auth'; import prisma from '../../lib/prisma'
export default async function handler(req,res){ const cookie = req.headers.cookie || ''; const match = cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith('alzack_token=')); if(!match) return res.status(401).json({error:'not auth'}); const token = match.split('=')[1]; const payload = verifyToken(token); if(!payload) return res.status(401).json({error:'invalid'}); const user = await prisma.user.findUnique({ where:{ id: payload.userId }, include:{ patient:true, caregiver:true } }); if(!user) return res.status(404).json({error:'no user'}); res.json({ id:user.id, name:user.name, role:user.role, patient:user.patient, caregiver:user.caregiver }) }
